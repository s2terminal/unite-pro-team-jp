---
import Layout from '../../layouts/Layout.astro';
import { getTeamSlugs, getTeamBySlug, getRosterForTeam, getPlayers } from '../../lib/models';
import TeamDetail from '../../components/pages/TeamDetail';

export async function getStaticPaths() {
  const slugs = await getTeamSlugs();
  return slugs.map((slug) => ({ params: { slug } }));
}

const { slug } = Astro.params;
const team = await getTeamBySlug(slug!);
if (!team) throw new Error(`Team not found: ${slug}`);
const roster = await getRosterForTeam(slug!);
const players = await getPlayers();
const playersBySlug = new Map(players.map((p) => [p.slug, p]));
---

<Layout>
  <TeamDetail
    client:visible
    team={team}
    current={roster.current}
    history={roster.history}
    playersBySlug={Object.fromEntries(playersBySlug)}
  />
</Layout>
